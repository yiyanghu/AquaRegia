<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Wed Apr 09 14:55:48 CDT 2014 -->
<title>PaymentChannelServer</title>
<meta name="date" content="2014-04-09">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PaymentChannelServer";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PaymentChannelServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelCloseException.CloseReason.html" title="enum in com.google.bitcoin.protocols.channels"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.ServerConnection.html" title="interface in com.google.bitcoin.protocols.channels"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelServer.html" target="_top">Frames</a></li>
<li><a href="PaymentChannelServer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.google.bitcoin.protocols.channels</div>
<h2 title="Class PaymentChannelServer" class="title">Class PaymentChannelServer</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.google.bitcoin.protocols.channels.PaymentChannelServer</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">PaymentChannelServer</span>
extends java.lang.Object</pre>
<div class="block"><p>A handler class which handles most of the complexity of creating a payment channel connection by providing a
 simple in/out interface which is provided with protobufs from the client and which generates protobufs which should
 be sent to the client.</p>

 <p>Does all required verification of messages and properly stores state objects in the wallet-attached
 <a href="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelServerStates.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredPaymentChannelServerStates</code></a> so that they are automatically closed when necessary and payment
 transactions are not lost if the application crashes before it unlocks.</p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.ServerConnection.html" title="interface in com.google.bitcoin.protocols.channels">PaymentChannelServer.ServerConnection</a></strong></code>
<div class="block">Implements the connection between this server and the client, providing an interface which allows messages to be
 sent to the client, requests for the connection to the client to be closed, and callbacks which occur when the
 channel is fully open or the client completes a payment.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#timeWindow">timeWindow</a></strong></code>
<div class="block">The amount of time we request the client lock in their funds.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#PaymentChannelServer(com.google.bitcoin.core.TransactionBroadcaster, com.google.bitcoin.core.Wallet, java.math.BigInteger, com.google.bitcoin.protocols.channels.PaymentChannelServer.ServerConnection)">PaymentChannelServer</a></strong>(<a href="../../../../../com/google/bitcoin/core/TransactionBroadcaster.html" title="interface in com.google.bitcoin.core">TransactionBroadcaster</a>&nbsp;broadcaster,
                    <a href="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</a>&nbsp;wallet,
                    java.math.BigInteger&nbsp;minAcceptedChannelSize,
                    <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.ServerConnection.html" title="interface in com.google.bitcoin.protocols.channels">PaymentChannelServer.ServerConnection</a>&nbsp;conn)</code>
<div class="block">Creates a new server-side state manager which handles a single client connection.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#close()">close</a></strong>()</code>
<div class="block">Closes the connection by generating a settle message for the client and calls
 <code>ServerConnection#destroyConnection(CloseReason)</code>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#connectionClosed()">connectionClosed</a></strong>()</code>
<div class="block">Called when the connection terminates.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#connectionOpen()">connectionOpen</a></strong>()</code>
<div class="block">Called to indicate the connection has been opened and messages can now be generated for the client.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#receiveMessage(org.bitcoin.paymentchannel.Protos.TwoWayChannelMessage)">receiveMessage</a></strong>(<a href="../../../../../org/bitcoin/paymentchannel/Protos.TwoWayChannelMessage.html" title="class in org.bitcoin.paymentchannel">Protos.TwoWayChannelMessage</a>&nbsp;msg)</code>
<div class="block">Called when a message is received from the client.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServerState</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#state()">state</a></strong>()</code>
<div class="block">Returns the underlying <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels"><code>PaymentChannelServerState</code></a> object that is being manipulated.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="timeWindow">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>timeWindow</h4>
<pre>public&nbsp;long timeWindow</pre>
<div class="block"><p>The amount of time we request the client lock in their funds.</p>

 <p>The value defaults to 24 hours - 60 seconds and should always be greater than 2 hours plus the amount of time
 the channel is expected to be used and smaller than 24 hours minus the client <-> server latency minus some
 factor to account for client clock inaccuracy.</p></div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="PaymentChannelServer(com.google.bitcoin.core.TransactionBroadcaster, com.google.bitcoin.core.Wallet, java.math.BigInteger, com.google.bitcoin.protocols.channels.PaymentChannelServer.ServerConnection)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>PaymentChannelServer</h4>
<pre>public&nbsp;PaymentChannelServer(<a href="../../../../../com/google/bitcoin/core/TransactionBroadcaster.html" title="interface in com.google.bitcoin.core">TransactionBroadcaster</a>&nbsp;broadcaster,
                    <a href="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</a>&nbsp;wallet,
                    java.math.BigInteger&nbsp;minAcceptedChannelSize,
                    <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.ServerConnection.html" title="interface in com.google.bitcoin.protocols.channels">PaymentChannelServer.ServerConnection</a>&nbsp;conn)</pre>
<div class="block">Creates a new server-side state manager which handles a single client connection.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>broadcaster</code> - The PeerGroup on which transactions will be broadcast - should have multiple connections.</dd><dd><code>wallet</code> - The wallet which will be used to complete transactions.
               Unlike <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClient.html" title="class in com.google.bitcoin.protocols.channels"><code>PaymentChannelClient</code></a>, this does not have to already contain a StoredState manager</dd><dd><code>minAcceptedChannelSize</code> - The minimum value the client must lock into this channel. A value too large will be
                               rejected by clients, and a value too low will require excessive channel reopening
                               and may cause fees to be require to settle the channel. A reasonable value depends
                               entirely on the expected maximum for the channel, and should likely be somewhere
                               between a few bitcents and a bitcoin.</dd><dd><code>conn</code> - A callback listener which represents the connection to the client (forwards messages we generate to
             the client and will close the connection on request)</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="state()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>state</h4>
<pre>@Nullable
public&nbsp;<a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServerState</a>&nbsp;state()</pre>
<div class="block">Returns the underlying <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels"><code>PaymentChannelServerState</code></a> object that is being manipulated. This object allows
 you to learn how much money has been transferred, etc. May be null if the channel wasn't negotiated yet.</div>
</li>
</ul>
<a name="receiveMessage(org.bitcoin.paymentchannel.Protos.TwoWayChannelMessage)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>receiveMessage</h4>
<pre>public&nbsp;void&nbsp;receiveMessage(<a href="../../../../../org/bitcoin/paymentchannel/Protos.TwoWayChannelMessage.html" title="class in org.bitcoin.paymentchannel">Protos.TwoWayChannelMessage</a>&nbsp;msg)</pre>
<div class="block">Called when a message is received from the client. Processes the given message and generates events based on its
 content.</div>
</li>
</ul>
<a name="connectionClosed()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>connectionClosed</h4>
<pre>public&nbsp;void&nbsp;connectionClosed()</pre>
<div class="block"><p>Called when the connection terminates. Notifies the <a href="../../../../../com/google/bitcoin/protocols/channels/StoredServerChannel.html" title="class in com.google.bitcoin.protocols.channels"><code>StoredServerChannel</code></a> object that we can attempt to
 resume this channel in the future and stops generating messages for the client.</p>

 <p>Note that this <b>MUST</b> still be called even after either
 <code>ServerConnection#destroyConnection(CloseReason)</code> or
 <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#close()"><code>close()</code></a> is called to actually handle the connection close logic.</p></div>
</li>
</ul>
<a name="connectionOpen()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>connectionOpen</h4>
<pre>public&nbsp;void&nbsp;connectionOpen()</pre>
<div class="block">Called to indicate the connection has been opened and messages can now be generated for the client.</div>
</li>
</ul>
<a name="close()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()</pre>
<div class="block"><p>Closes the connection by generating a settle message for the client and calls
 <code>ServerConnection#destroyConnection(CloseReason)</code>. Note that this does not broadcast
 the payment transaction and the client may still resume the same channel if they reconnect</p>

 <p>Note that <a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html#connectionClosed()"><code>connectionClosed()</code></a> must still be called after the connection fully
 closes.</p></div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PaymentChannelServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelCloseException.CloseReason.html" title="enum in com.google.bitcoin.protocols.channels"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.ServerConnection.html" title="interface in com.google.bitcoin.protocols.channels"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelServer.html" target="_top">Frames</a></li>
<li><a href="PaymentChannelServer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
